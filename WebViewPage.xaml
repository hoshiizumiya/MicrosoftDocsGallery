<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MicrosoftDocsGallery.WebViewPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:MicrosoftDocsGallery"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <!--  新增：本页资源，补齐 SubtleButtonStyle，避免页面加载抛错  -->
    <Page.Resources>
        <Style x:Key="SubtleButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="4" />
            <Setter Property="MinWidth" Value="0" />
            <Setter Property="MinHeight" Value="0" />
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Foreground" Value="{ThemeResource ButtonForeground}" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <!--  NavigationView for table of contents  -->
            <ColumnDefinition
                Width="200"
                MinWidth="200"
                MaxWidth="400" />
            <ColumnDefinition Width="Auto" />
            <!--  Main content area  -->
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Table of Contents NavigationView  -->
        <NavigationView
            x:Name="DocNavigationView"
            Grid.Column="0"
            Header="Table of Contents"
            IsBackButtonVisible="Collapsed"
            IsPaneToggleButtonVisible="False"
            IsSettingsVisible="False"
            ItemInvoked="DocNavigation_ItemInvoked"
            OpenPaneLength="300"
            PaneDisplayMode="Top">

            <NavigationView.MenuItems>
                <!--  TOC items will be populated dynamically  -->
            </NavigationView.MenuItems>

            <NavigationView.Content>
                <StackPanel Margin="10" Spacing="8">
                    <!--  Search box for quick navigation  -->
                    <TextBox
                        x:Name="SectionSearchBox"
                        PlaceholderText="Search in document..."
                        TextChanged="SectionSearch_TextChanged" />

                    <!--  Favorite button  -->
                    <Button
                        x:Name="FavoriteButton"
                        HorizontalAlignment="Stretch"
                        Click="FavoriteButton_Click"
                        Content="Add to Favorites"
                        Style="{StaticResource AccentButtonStyle}">
                        <Button.Resources>
                            <Style BasedOn="{StaticResource AccentButtonStyle}" TargetType="Button">
                                <Setter Property="Content" Value="Add to Favorites" />
                                <Setter Property="Foreground" Value="White" />
                            </Style>
                        </Button.Resources>
                    </Button>

                    <!--  Quick actions  -->
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Button
                            Click="RefreshPage_Click"
                            Content="&#xE72C;"
                            FontFamily="Segoe MDL2 Assets"
                            Style="{StaticResource SubtleButtonStyle}"
                            ToolTipService.ToolTip="Refresh" />
                        <Button
                            Click="OpenInBrowser_Click"
                            Content="&#xE8A7;"
                            FontFamily="Segoe MDL2 Assets"
                            Style="{StaticResource SubtleButtonStyle}"
                            ToolTipService.ToolTip="Open in Browser" />
                        <Button
                            Click="SharePage_Click"
                            Content="&#xE72D;"
                            FontFamily="Segoe MDL2 Assets"
                            Style="{StaticResource SubtleButtonStyle}"
                            ToolTipService.ToolTip="Share" />
                    </StackPanel>
                </StackPanel>
            </NavigationView.Content>
        </NavigationView>

        <!--  Splitter  -->
        <Border
            Grid.Column="1"
            Width="1"
            Background="{ThemeResource SystemControlBackgroundBaseLowBrush}" />

        <!--  Main TabView Area  -->
        <TabView
            x:Name="WebTabView"
            Grid.Column="2"
            AddTabButtonClick="TabView_AddButtonClick"
            CloseButtonOverlayMode="OnPointerOver"
            SelectionChanged="TabView_SelectionChanged"
            TabCloseRequested="TabView_TabCloseRequested">

            <!--  Default tab template  -->
            <TabView.TabItemTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!--  Tab icon  -->
                        <FontIcon
                            Grid.Column="0"
                            Margin="0,0,6,0"
                            FontSize="12"
                            Glyph="&#xE7BE;" />

                        <!--  Tab title  -->
                        <TextBlock
                            Grid.Column="1"
                            MaxWidth="150"
                            VerticalAlignment="Center"
                            Text="{Binding Title}"
                            TextTrimming="CharacterEllipsis" />

                        <!--  Loading indicator  -->
                        <ProgressRing
                            Grid.Column="2"
                            Width="16"
                            Height="16"
                            Margin="6,0,0,0"
                            IsActive="{Binding IsLoading}"
                            Visibility="{Binding IsLoading}" />
                    </Grid>
                </DataTemplate>
            </TabView.TabItemTemplate>
        </TabView>
    </Grid>
</Page>
