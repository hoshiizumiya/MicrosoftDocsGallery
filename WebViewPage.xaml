<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="MicrosoftDocsGallery.WebViewPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:MicrosoftDocsGallery"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Loaded="Page_Loaded"
    SizeChanged="Page_SizeChanged"
    mc:Ignorable="d">

    <!--  新增：本页资源，补齐 SubtleButtonStyle，避免页面加载抛错  -->
    <Page.Resources>
        <Style x:Key="SubtleButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderBrush" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="4" />
            <Setter Property="MinWidth" Value="0" />
            <Setter Property="MinHeight" Value="0" />
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Foreground" Value="{ThemeResource ButtonForeground}" />
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <!--  NavigationView for table of contents  -->
            <ColumnDefinition
                x:Name="TocColumn"
                Width="200"
                MinWidth="100"
                MaxWidth="400" />
            <ColumnDefinition Width="Auto" />
            <!--  Main content area  -->
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Table of Contents NavigationView  -->
        <NavigationView
            x:Name="DocNavigationView"
            Grid.Column="0"
            IsBackButtonVisible="Collapsed"
            IsPaneToggleButtonVisible="False"
            IsSettingsVisible="False"
            ItemInvoked="DocNavigation_ItemInvoked"
            OpenPaneLength="300"
            PaneDisplayMode="Top">

            <NavigationView.MenuItems>
                <!--  TOC items will be populated dynamically  -->
            </NavigationView.MenuItems>

            <NavigationView.Content>
                <StackPanel Margin="10" Spacing="8">
                    <!--  Search box for quick navigation  -->
                    <TextBox
                        x:Name="SectionSearchBox"
                        PlaceholderText="Search in document..."
                        TextChanged="SectionSearch_TextChanged" />

                    <!--  Favorite button  -->
                    <Button
                        x:Name="FavoriteButton"
                        HorizontalAlignment="Stretch"
                        Click="FavoriteButton_Click"
                        Content="Add to Favorites"
                        Style="{StaticResource AccentButtonStyle}">
                        <Button.Resources>
                            <Style BasedOn="{StaticResource AccentButtonStyle}" TargetType="Button">
                                <Setter Property="Content" Value="Add to Favorites" />
                                <Setter Property="Foreground" Value="White" />
                            </Style>
                        </Button.Resources>
                    </Button>

                    <!--  Quick actions  -->
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <Button
                            Click="RefreshPage_Click"
                            Content="&#xE72C;"
                            FontFamily="Segoe MDL2 Assets"
                            Style="{StaticResource SubtleButtonStyle}"
                            ToolTipService.ToolTip="Refresh" />
                        <Button
                            Click="OpenInBrowser_Click"
                            Content="&#xE8A7;"
                            FontFamily="Segoe MDL2 Assets"
                            Style="{StaticResource SubtleButtonStyle}"
                            ToolTipService.ToolTip="Open in Browser" />
                        <Button
                            Click="SharePage_Click"
                            Content="&#xE72D;"
                            FontFamily="Segoe MDL2 Assets"
                            Style="{StaticResource SubtleButtonStyle}"
                            ToolTipService.ToolTip="Share" />
                    </StackPanel>
                </StackPanel>
            </NavigationView.Content>
        </NavigationView>

        <!--  Splitter（可拖拽调整左右间隔）  -->
        <Border
            x:Name="ColumnSplitter"
            Grid.Column="1"
            Width="5"
            Background="Transparent"
            PointerEntered="ColumnSplitter_PointerEntered"
            PointerExited="ColumnSplitter_PointerExited"
            PointerMoved="ColumnSplitter_PointerMoved"
            PointerPressed="ColumnSplitter_PointerPressed"
            PointerReleased="ColumnSplitter_PointerReleased">
            <!--  保持原有的 1px 视觉分割线，同时扩大 5px 命中区域  -->
            <Border
                Width="1"
                HorizontalAlignment="Center"
                Background="{ThemeResource SystemControlBackgroundBaseLowBrush}" />
        </Border>

        <!--  Main TabView Area  -->
        <TabView
            x:Name="WebTabView"
            Grid.Column="2"
            Height="{Binding ActualHeight, ElementName=ColumnSplitter, Mode=OneTime}"
            AddTabButtonClick="TabView_AddButtonClick"
            CloseButtonOverlayMode="OnPointerOver"
            SelectionChanged="TabView_SelectionChanged"
            TabCloseRequested="TabView_TabCloseRequested">
            <TabView.KeyboardAccelerators>
                <KeyboardAccelerator
                    Key="T"
                    Invoked="NewTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="T"
                    Invoked="ReopenClosedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control,Shift" />
                <KeyboardAccelerator
                    Key="W"
                    Invoked="CloseSelectedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="R"
                    Invoked="ReloadSelectedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number1"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number2"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number3"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number4"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number5"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number6"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number7"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number8"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
                <KeyboardAccelerator
                    Key="Number9"
                    Invoked="NavigateToNumberedTabKeyboardAccelerator_Invoked"
                    Modifiers="Control" />
            </TabView.KeyboardAccelerators>

        </TabView>
    </Grid>
</Page>
